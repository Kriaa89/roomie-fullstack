<div class="property-detail-container">
  <div class="back-button">
    <button class="btn btn-outline" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Back to Dashboard
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading property details...</p>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <div *ngIf="!isLoading && property" class="property-detail-card">

    <div class="property-header">
      <h1>{{ property.name }}</h1>
      <div class="property-badge" [ngClass]="{'available': property.availability, 'unavailable': !property.availability}">
        {{ property.availability ? 'Available' : 'Not Available' }}
      </div>
    </div>

    <div class="property-location">
      <i class="fas fa-map-marker-alt"></i> {{ property.location }}
    </div>

    <div class="property-map">
      <h2>Location</h2>
      <div id="map" class="map-container"></div>
    </div>

    <div class="property-price">
      {{ property.price }}
    </div>

    <div class="property-info">
      <div class="info-item">
        <i class="fas fa-home"></i>
        <span>Type: {{ property.type }}</span>
      </div>
      <div class="info-item" *ngIf="property.surface">
        <i class="fas fa-ruler-combined"></i>
        <span>Surface: {{ property.surface }}</span>
      </div>
      <div class="info-item" *ngIf="property.numberOfRooms">
        <i class="fas fa-door-open"></i>
        <span>Rooms: {{ property.numberOfRooms }}</span>
      </div>
      <div class="info-item" *ngIf="property.numberOfBedrooms">
        <i class="fas fa-bed"></i>
        <span>Bedrooms: {{ property.numberOfBedrooms }}</span>
      </div>
      <div class="info-item" *ngIf="property.numberOfBathrooms">
        <i class="fas fa-bath"></i>
        <span>Bathrooms: {{ property.numberOfBathrooms }}</span>
      </div>
      <div class="info-item" *ngIf="property.audiance">
        <i class="fas fa-users"></i>
        <span>Audience: {{ property.audiance }}</span>
      </div>
    </div>

    <div class="property-description">
      <h2>Description</h2>
      <p>{{ property.description }}</p>
    </div>

    <div *ngIf="property.amenities" class="property-amenities">
      <h2>Amenities</h2>
      <ul class="amenities-list">
        <li *ngFor="let amenity of property.amenities.split(',')">
          <i class="fas fa-check"></i> {{ amenity.trim() }}
        </li>
      </ul>
    </div>

    <div *ngIf="property.propertyRules" class="property-rules">
      <h2>Property Rules</h2>
      <ul class="rules-list">
        <li *ngFor="let rule of property.propertyRules.split(',')">
          <i class="fas fa-info-circle"></i> {{ rule.trim() }}
        </li>
      </ul>
    </div>

    <div class="property-owner" *ngIf="property.owner">
      <h2>Owner</h2>
      <p>{{ property.owner.firstName }} {{ property.owner.lastName }}</p>
    </div>

    <!-- AI-Powered Property Insights (only shown to non-owners) -->
    <app-property-insights *ngIf="!isOwner" [property]="property" [user]="user"></app-property-insights>

    <div class="property-visit" *ngIf="!isOwner && property.availability">
      <h2>Request a Visit</h2>
      <p>Select a date to visit this property:</p>
      <div class="visit-form">
        <div class="form-group">
          <label for="visitDate">Visit Date</label>
          <input
            type="date"
            id="visitDate"
            class="form-control"
            [min]="minDate"
            [(ngModel)]="visitDate"
            required>
        </div>
        <button class="btn btn-primary" (click)="requestVisit()" [disabled]="!visitDate || isLoading">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          <i *ngIf="!isLoading" class="fas fa-calendar-check"></i>
          {{ isLoading ? 'Submitting...' : 'Request Visit' }}
        </button>

        <div *ngIf="visitRequestSuccess" class="alert alert-success mt-3">
          <i class="fas fa-check-circle"></i> Visit request submitted successfully! The owner will review your request.
        </div>

        <div *ngIf="visitRequestError" class="alert alert-danger mt-3">
          <i class="fas fa-exclamation-circle"></i> {{ visitRequestError }}
        </div>
      </div>
    </div>

    <div class="property-actions" *ngIf="isOwner">
      <button class="btn btn-primary" (click)="editProperty()">
        <i class="fas fa-edit"></i> Edit Property
      </button>
      <button class="btn btn-danger" (click)="deleteProperty()">
        <i class="fas fa-trash"></i> Delete Property
      </button>
    </div>
  </div>
</div>
