<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Property Owner Dashboard</h1>
    <p *ngIf="currentUser">Welcome, {{ currentUser.firstName }} {{ currentUser.lastName }}</p>

  </div>


  <!-- User Profile Section -->
  <section class="dashboard-section">
    <div class="section-header">
      <h2>My Profile</h2>
      <a routerLink="/owner/profile" class="btn btn-primary">Edit Profile</a>
    </div>

    <div class="section-content">
      <div *ngIf="loading.user" class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading profile...</p>
      </div>

      <div *ngIf="error.user" class="error-message">
        {{ error.user }}
      </div>

      <div *ngIf="!loading.user && !error.user && currentUser" class="profile-card">
        <div class="profile-image">
          <img [src]="currentUser.profilePicture || 'assets/images/default-profile.png'" alt="Profile Picture">
        </div>
        <div class="profile-details">
          <h3>{{ currentUser.firstName }} {{ currentUser.lastName }}</h3>
          <p><strong>Email:</strong> {{ currentUser.email }}</p>
          <p><strong>Phone:</strong> {{ currentUser.phoneNumber }}</p>
          <p><strong>Location:</strong> {{ currentUser.location }}</p>
        </div>
      </div>
    </div>
  </section>

  <!-- My Properties Section -->
  <section class="dashboard-section">
    <div class="section-header">
      <h2>My Properties</h2>
      <a routerLink="/owner/properties/new" class="btn btn-primary">Add New Property</a>
    </div>

    <div class="section-content">
      <div *ngIf="loading.properties" class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading properties...</p>
      </div>

      <div *ngIf="error.properties" class="error-message">
        {{ error.properties }}
      </div>

      <div *ngIf="!loading.properties && !error.properties" class="cards-container">
        <div *ngIf="myProperties.length === 0" class="empty-state">
          <p>You haven't listed any properties yet. Add your first property to get started!</p>
        </div>

        <div *ngFor="let property of myProperties" class="property-card">
          <div class="property-image">
            <img [src]="property.images.split(',')[0] || 'assets/images/default-property.png'" alt="{{ property.name }}">
          </div>
          <div class="property-details">
            <h3>{{ property.name }}</h3>
            <p><strong>Location:</strong> {{ property.location }}</p>
            <p><strong>Price:</strong> {{ property.price }}</p>
            <p><strong>Type:</strong> {{ property.type }}</p>
            <p><strong>Status:</strong> <span [ngClass]="property.availability ? 'status-available' : 'status-unavailable'">
              {{ property.availability ? 'Available' : 'Not Available' }}
            </span></p>
            <div class="property-actions">
              <a [routerLink]="['/owner/properties', property.id]" class="btn btn-secondary">View</a>
              <a [routerLink]="['/owner/properties/edit', property.id]" class="btn btn-secondary">Edit</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Visit Requests Section -->
  <section class="dashboard-section">
    <div class="section-header">
      <h2>Visit Requests</h2>
      <a routerLink="/owner/visits" class="btn btn-primary">View All Requests</a>
    </div>

    <div class="section-content">
      <div *ngIf="loading.visits" class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading visit requests...</p>
      </div>

      <div *ngIf="error.visits" class="error-message">
        {{ error.visits }}
      </div>

      <div *ngIf="!loading.visits && !error.visits" class="cards-container">
        <div *ngIf="visitRequests.length === 0" class="empty-state">
          <p>No visit requests yet. When renters request to visit your properties, they'll appear here.</p>
        </div>

        <div *ngFor="let visit of visitRequests" class="visit-card">
          <div class="visit-details">
            <h3>{{ visit.property?.name || 'Property' }}</h3>
            <p><strong>Requester:</strong> {{ visit.requester.firstName }} {{ visit.requester.lastName }}</p>
            <p><strong>Date:</strong> {{ visit.requestDate | date }}</p>
            <p><strong>Time:</strong> {{ visit.requestTime }}</p>
            <p><strong>Message:</strong> {{ visit.message || 'No message provided' }}</p>
            <p><strong>Status:</strong> <span [ngClass]="'status-' + visit.status.toLowerCase()">{{ visit.status }}</span></p>

            <div *ngIf="visit.status === 'PENDING'" class="visit-actions">
              <button (click)="approveVisitRequest(visit.id)" class="btn btn-success">Approve</button>
              <button (click)="rejectVisitRequest(visit.id)" class="btn btn-danger">Reject</button>
            </div>

            <div *ngIf="visit.status !== 'PENDING'" class="visit-response">
              <p><strong>Response:</strong> {{ visit.responseMessage || 'No response provided' }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
